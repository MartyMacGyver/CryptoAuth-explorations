// Builds all examples for the SHA204 library using makefiles generated by Eclipse projects. 
// Run CScript, not WScript (CScript <this file>).

function BuildProject(project)
{
   var status = 0;
   
   while (!project.StdOut.AtEndOfStream)
   {
      WScript.Echo(project.StdOut.ReadLine());
   }
   
   while (!project.StdErr.AtEndOfStream)
   {
      WScript.StdErr.WriteLine(project.StdErr.ReadLine());
      status = -1; 
   }
   return status;
}


var cc = "\\WinAVR-20100110\\utils\\bin\\make -B -C ";
var outPath = new Array(
   "EclipseAT90USB1287\\BitBangTimeLoops",
   "EclipseAT90USB1287\\BitBang",
   "EclipseAT90USB1287\\Twi",
   "EclipseAT90USB1287\\Uart",
   "EclipseAT90USB1287\\TwiMacExample"
   );
var wshShell = WScript.CreateObject("WScript.Shell");
var project;
var i;

WScript.Echo("Building AVR Studio examples...\n");

for (i = 0; i < outPath.length; i++)
{
   project = wshShell.Exec(cc + outPath[i] + " all");
   
   WScript.Echo("\n*******************************************************\n");

   if (BuildProject(project) != 0)
   {
      WScript.StdErr.WriteLine("\nError building " + outPath[i]);
      WScript.Quit();
   }
}

WScript.Echo("\n*******************************************************\n");
WScript.Echo("\nFinished building SHA204 library examples.");
   